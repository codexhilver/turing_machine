<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turing Machine Visualizer</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PlayIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const PauseIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const ResetIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const StepIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const BookIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
        );

        const TuringMachineVisualizer = () => {
            const [selectedExample, setSelectedExample] = useState('0n1n');
            const [inputString, setInputString] = useState('0011');
            const [tape, setTape] = useState([]);
            const [headPosition, setHeadPosition] = useState(0);
            const [currentState, setCurrentState] = useState('q0');
            const [isRunning, setIsRunning] = useState(false);
            const [isPaused, setIsPaused] = useState(false);
            const [stepCount, setStepCount] = useState(0);
            const [result, setResult] = useState('');
            const [speed, setSpeed] = useState(500);
            const [showDescription, setShowDescription] = useState(true);

            const examples = {
                '0n1n': {
                    name: '0ⁿ1ⁿ (Equal 0s and 1s)',
                    description: 'Accepts strings with equal numbers of 0s followed by equal numbers of 1s',
                    examples: ['01', '0011', '000111', 'ε'],
                    defaultInput: '0011',
                    transitions: {
                        q0: { '0': ['q1', 'X', 'R'], '1': ['reject', '1', 'R'], 'Y': ['q3', 'Y', 'R'], '_': ['accept', '_', 'S'] },
                        q1: { '0': ['q1', '0', 'R'], '1': ['q2', 'Y', 'L'], 'Y': ['q1', 'Y', 'R'], '_': ['reject', '_', 'S'] },
                        q2: { '0': ['q2', '0', 'L'], 'X': ['q0', 'X', 'R'], 'Y': ['q2', 'Y', 'L'] },
                        q3: { 'Y': ['q3', 'Y', 'R'], '_': ['accept', '_', 'S'] }
                    }
                },
                'ww': {
                    name: 'ww (Doubled String)',
                    description: 'Accepts strings that consist of two identical halves',
                    examples: ['00', '0101', '1111'],
                    defaultInput: '0101',
                    transitions: {
                        q0: { '0': ['q1', 'X', 'R'], '1': ['q2', 'X', 'R'], '_': ['accept', '_', 'S'] },
                        q1: { '0': ['q1', '0', 'R'], '1': ['q1', '1', 'R'], '#': ['q3', '#', 'R'] },
                        q2: { '0': ['q2', '0', 'R'], '1': ['q2', '1', 'R'], '#': ['q4', '#', 'R'] },
                        q3: { '0': ['q5', 'Y', 'L'], 'Y': ['q3', 'Y', 'R'], '_': ['reject', '_', 'S'] },
                        q4: { '1': ['q5', 'Y', 'L'], 'Y': ['q4', 'Y', 'R'], '_': ['reject', '_', 'S'] },
                        q5: { '0': ['q5', '0', 'L'], '1': ['q5', '1', 'L'], '#': ['q5', '#', 'L'], 'X': ['q6', 'X', 'R'], 'Y': ['q5', 'Y', 'L'] },
                        q6: { '0': ['q1', 'X', 'R'], '1': ['q2', 'X', 'R'], '#': ['q7', '#', 'R'] },
                        q7: { 'Y': ['q7', 'Y', 'R'], '_': ['accept', '_', 'S'] }
                    }
                },
                'palindrome': {
                    name: 'Palindrome',
                    description: 'Accepts strings that read the same forwards and backwards',
                    examples: ['0', '101', '11011', '0110110'],
                    defaultInput: '101',
                    transitions: {
                     q0: { '0': ['q1', 'X', 'R'], '1': ['q2', 'X', 'R'], 'X': ['q0', 'X', 'R'], '_': ['accept', '_', 'S'] },
                    q1: { '0': ['q1', '0', 'R'], '1': ['q1', '1', 'R'], 'X': ['q1', 'X', 'R'], '_': ['q3', '_', 'L'] },
                    q2: { '0': ['q2', '0', 'R'], '1': ['q2', '1', 'R'], 'X': ['q2', 'X', 'R'], '_': ['q4', '_', 'L'] },
        
        // FIXED: Don't reject when reaching '_', go back to q0
                     q3: { '0': ['q5', 'X', 'L'], 'X': ['q3', 'X', 'L'], '1': ['reject', '1', 'S'], '_': ['q0', '_', 'R'] },
                    q4: { '1': ['q5', 'X', 'L'], 'X': ['q4', 'X', 'L'], '0': ['reject', '0', 'S'], '_': ['q0', '_', 'R'] },

                     q5: { '0': ['q5', '0', 'L'], '1': ['q5', '1', 'L'], 'X': ['q5', 'X', 'L'], '_': ['q0', '_', 'R'] }
    }
},

                'anbncn': {
                    name: 'aⁿbⁿcⁿ',
                    description: 'Accepts strings with equal numbers of a, b, and c in order',
                    examples: ['abc', 'aabbcc', 'aaabbbccc'],
                    defaultInput: 'aabbcc',
                    transitions: {
                        q0: { 'a': ['q1', 'X', 'R'], 'Y': ['q5', 'Y', 'R'], '_': ['accept', '_', 'S'] },
                        q1: { 'a': ['q1', 'a', 'R'], 'Y': ['q1', 'Y', 'R'], 'b': ['q2', 'Y', 'R'], '_': ['reject', '_', 'S'] },
                        q2: { 'b': ['q2', 'b', 'R'], 'Z': ['q2', 'Z', 'R'], 'c': ['q3', 'Z', 'L'], '_': ['reject', '_', 'S'] },
                        q3: { 'a': ['q3', 'a', 'L'], 'b': ['q3', 'b', 'L'], 'Y': ['q3', 'Y', 'L'], 'Z': ['q3', 'Z', 'L'], 'X': ['q0', 'X', 'R'] },
                        q5: { 'Y': ['q5', 'Y', 'R'], 'Z': ['q5', 'Z', 'R'], '_': ['accept', '_', 'S'] }
                    }
                }
            };

            useEffect(() => {
                initializeTape();
            }, [inputString]);

            const initializeTape = () => {
                const input = inputString === 'ε' ? '' : inputString;
                let tapeContent;
                
                if (selectedExample === 'ww') {
                    const mid = Math.floor(input.length / 2);
                    tapeContent = input.slice(0, mid) + '#' + input.slice(mid);
                } else {
                    tapeContent = input;
                }
                
                const newTape = ['_', ...tapeContent.split(''), '_', '_', '_', '_'];
                setTape(newTape);
                setHeadPosition(1);
                setCurrentState('q0');
                setStepCount(0);
                setResult('');
                setIsRunning(false);
                setIsPaused(false);
            };

            const step = () => {
                if (currentState === 'accept' || currentState === 'reject') {
                    setIsRunning(false);
                    setResult(currentState === 'accept' ? 'ACCEPTED ✓' : 'REJECTED ✗');
                    return false;
                }

                const currentSymbol = tape[headPosition] || '_';
                const transition = examples[selectedExample].transitions[currentState];
                
                if (!transition || !transition[currentSymbol]) {
                    setCurrentState('reject');
                    setResult('REJECTED ✗');
                    setIsRunning(false);
                    return false;
                }

                const [nextState, writeSymbol, direction] = transition[currentSymbol];
                
                const newTape = [...tape];
                newTape[headPosition] = writeSymbol;
                
                let newHeadPosition = headPosition;
                if (direction === 'R') newHeadPosition++;
                else if (direction === 'L') newHeadPosition--;
                
                if (newHeadPosition >= newTape.length) {
                    newTape.push('_');
                } else if (newHeadPosition < 0) {
                    newTape.unshift('_');
                    newHeadPosition = 0;
                }
                
                setTape(newTape);
                setHeadPosition(newHeadPosition);
                setCurrentState(nextState);
                setStepCount(prev => prev + 1);
                
                if (nextState === 'accept' || nextState === 'reject') {
                    setResult(nextState === 'accept' ? 'ACCEPTED ✓' : 'REJECTED ✗');
                    setIsRunning(false);
                    return false;
                }
                
                return true;
            };

            useEffect(() => {
                let interval;
                if (isRunning && !isPaused) {
                    interval = setInterval(() => {
                        const canContinue = step();
                        if (!canContinue) {
                            setIsRunning(false);
                        }
                    }, speed);
                }
                return () => clearInterval(interval);
            }, [isRunning, isPaused, tape, headPosition, currentState, speed]);

            const handleRun = () => {
                if (currentState === 'accept' || currentState === 'reject') {
                    initializeTape();
                }
                setIsRunning(true);
                setIsPaused(false);
            };

            const handlePause = () => {
                setIsPaused(!isPaused);
            };

            const handleReset = () => {
                initializeTape();
            };

            const handleExampleChange = (exampleKey) => {
                setSelectedExample(exampleKey);
                setInputString(examples[exampleKey].defaultInput);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-2xl p-8">
                            <div className="flex items-center justify-between mb-6">
                                <h1 className="text-3xl font-bold text-indigo-900">Turing Machine Visualizer</h1>
                                <button
                                    onClick={() => setShowDescription(!showDescription)}
                                    className="flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors"
                                >
                                    <BookIcon />
                                    {showDescription ? 'Hide' : 'Show'} Info
                                </button>
                            </div>

                            {showDescription && (
                                <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                    <h3 className="font-semibold text-blue-900 mb-2">{examples[selectedExample].name}</h3>
                                    <p className="text-blue-800 mb-2">{examples[selectedExample].description}</p>
                                    <p className="text-sm text-blue-600">
                                        Try: {examples[selectedExample].examples.join(', ')}
                                    </p>
                                </div>
                            )}

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Select Language
                                    </label>
                                    <select
                                        value={selectedExample}
                                        onChange={(e) => handleExampleChange(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    >
                                        {Object.entries(examples).map(([key, ex]) => (
                                            <option key={key} value={key}>{ex.name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Input String (use 'ε' for empty)
                                    </label>
                                    <input
                                        type="text"
                                        value={inputString}
                                        onChange={(e) => setInputString(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        disabled={isRunning}
                                    />
                                </div>
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Speed: {1000 - speed}ms delay
                                </label>
                                <input
                                    type="range"
                                    min="100"
                                    max="900"
                                    step="100"
                                    value={1000 - speed}
                                    onChange={(e) => setSpeed(1000 - parseInt(e.target.value))}
                                    className="w-full"
                                />
                            </div>

                            <div className="mb-8">
                                <div className="flex items-center gap-2 mb-4">
                                    <span className="text-sm font-medium text-gray-700">Tape:</span>
                                    <span className="text-xs text-gray-500">(Head position: {headPosition})</span>
                                </div>
                                <div className="flex overflow-x-auto pb-4 gap-1">
                                    {tape.map((symbol, index) => (
                                        <div
                                            key={index}
                                            className={`min-w-[50px] h-16 flex items-center justify-center border-2 rounded font-mono text-xl font-bold transition-all ${
                                                index === headPosition
                                                    ? 'bg-indigo-500 text-white border-indigo-600 scale-110 shadow-lg'
                                                    : 'bg-white text-gray-800 border-gray-300'
                                            }`}
                                        >
                                            {symbol}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="p-4 bg-gray-50 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Current State</div>
                                    <div className="text-2xl font-bold text-indigo-600">{currentState}</div>
                                </div>
                                <div className="p-4 bg-gray-50 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Steps</div>
                                    <div className="text-2xl font-bold text-gray-800">{stepCount}</div>
                                </div>
                                <div className="p-4 bg-gray-50 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Result</div>
                                    <div className={`text-2xl font-bold ${result.includes('ACCEPTED') ? 'text-green-600' : result.includes('REJECTED') ? 'text-red-600' : 'text-gray-400'}`}>
                                        {result || '—'}
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-4">
                                <button
                                    onClick={handleRun}
                                    disabled={isRunning && !isPaused}
                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium"
                                >
                                    <PlayIcon />
                                    {isRunning ? 'Running...' : 'Run'}
                                </button>
                                <button
                                    onClick={handlePause}
                                    disabled={!isRunning || currentState === 'accept' || currentState === 'reject'}
                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium"
                                >
                                    <PauseIcon />
                                    {isPaused ? 'Resume' : 'Pause'}
                                </button>
                                <button
                                    onClick={step}
                                    disabled={isRunning || currentState === 'accept' || currentState === 'reject'}
                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium"
                                >
                                    <StepIcon />
                                    Step
                                </button>
                                <button
                                    onClick={handleReset}
                                    className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
                                >
                                    <ResetIcon />
                                    Reset
                                </button>
                            </div>

                            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                <h3 className="text-sm font-semibold text-gray-700 mb-2">How to Use:</h3>
                                <ol className="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                                    <li>Select a language example from the dropdown</li>
                                    <li>Enter your input string (or use the default)</li>
                                    <li>Click "Run" to execute automatically or "Step" to move one transition at a time</li>
                                    <li>Watch the tape head move and the state change</li>
                                    <li>See if the string is ACCEPTED or REJECTED</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TuringMachineVisualizer />, document.getElementById('root'));
    </script>
</body>
</html>
